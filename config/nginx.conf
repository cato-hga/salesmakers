# upstream oneconnect {
#   server unix:///opt/oneconnect/shared/tmp/sockets/puma.sock;
# }
#
# server {
#   listen 80 default_server deferred;
#   # server_name example.com;
#
#   root /opt/oneconnect/current/public;
#   access_log /opt/oneconnect/current/log/nginx.access.log;
#   error_log /opt/oneconnect/current/log/nginx.error.log info;
#
#   location ^~ /assets/ {
#     gzip_static on;
#     expires max;
#     add_header Cache-Control public;
#   }
#
#   try_files $uri/index.html $uri @oneconnect;
#   location @oneconnect {
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header Host $http_host;
#     proxy_redirect off;
#
#     proxy_pass http://oneconnect;
#   }
#
#   error_page 500 502 503 504 /500.html;
#  client_max_body_size 10M;
#   keepalive_timeout 10;
# }

upstream oneconnect {
        server unix:///opt/oneconnect/shared/tmp/sockets/puma.sock;
}

server {
        listen 80 default_server;
        listen 443;

        ssl on;
        ssl_certificate         /etc/ssl/one.rbdconnect.com.crt;
        ssl_certificate_key     /etc/ssl/RBDCONNECT_COM.key;

        root /opt/oneconnect/current/public;
        try_files $uri @oneconnect;

        access_log /opt/oneconnect/current/log/nginx.access.log;
        error_log /opt/oneconnect/current/log/nginx.error.log info;

        server_name one.rbdconnect.com;

        location ~ ^/(assets)/  {
          root /opt/oneconnect/current/public;
          gzip_static on;
          expires max;
          add_header Cache-Control public;
        }

        location @oneconnect {
                proxy_read_timeout 300;
                proxy_connect_timeout 300;
                proxy_redirect off;
                proxy_set_header X-Forwarded-Proto $scheme;
                proxy_set_header Host $http_host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_pass http://oneconnect;
        }
}