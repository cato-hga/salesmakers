- title 'Swap Line for ' + @device.identifier

%section#line_swap_table
  - header = header_row [sort_link(@search, :technology_service_provider_name, 'Provider'),sort_link(@search, :identifier),sort_link(@search, :device_serial, 'Device'),sort_link(@search, :contract_end_date, 'Contract End Date'),'State(s)', 'Swap']
  - rows = Array.new
  - for line in @lines do
    - service_provider = line.technology_service_provider
    - provider = link_to service_provider.name, '#'
    - identifier =  line_link line
    - device_link = line.device ? device_link(line.device) : ''
    - if line.contract_end_date == Date.parse('01/01/1901')
      - contract_end_date = ''
    - else
      - contract_end_date = link_to short_date(line.contract_end_date), line
    - states = line_state_links line
    - active_state = LineState.find_or_initialize_by name: 'Active'
    - if line.line_states.include? active_state
      - swap_button = link_to 'Swap Line', swap_results_device_path(@device, line), class: [:deploy_button, :button]
    - else
      - swap_button = ''
    - rows << table_row([provider,identifier,device_link,contract_end_date,states, swap_button])
  = table header, rows

- content_for :footer do
  = paginate @lines