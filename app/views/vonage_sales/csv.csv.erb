<% headers = ['Date', 'Seller', 'MAC ID', 'Location Name', 'Store Number', 'Address', 'Customer', 'Product', 'Gift Card', 'Areas', 'Vested?'] %><%= CSV.generate_line(headers).html_safe %><% @vonage_sales.each do |sale| %><% customer_name = NameCase sale.customer_first_name + ' ' + sale.customer_last_name %><%= CSV.generate_line([short_date(sale.sale_date), NameCase(sale.person.display_name), sale.mac, sale.location.name, sale.location.store_number, sale.location.address, customer_name, sale.vonage_product.name, sale.gift_card_number, sale.location.location_areas.joins(area: :project).where("projects.name = 'Vonage Retail'").map { |la| la.area.ancestors.map { |a| a.name } << la.area.name }.join(", "), sale.vested? ? 'Yes' : 'No']).html_safe %><% end %>