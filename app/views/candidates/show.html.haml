- title @candidate.name
- content_for :action_buttons do
  - if @candidate.active?
    = link_to 'Dismiss Candidate', dismiss_candidate_path(@candidate), data: { confirm: 'This will dismiss the candidate. Are you sure?' }, class: [:button, :inline_button]
  - unless @candidate.passed_personality_assessment?
    = button_to 'Mark Personality Assessment Passed', passed_assessment_candidate_path(@candidate), class: [:button, :inline_button], method: :put
    = button_to 'Mark Personality Assessment Failed', failed_assessment_candidate_path(@candidate), class: [:button, :inline_button, :alert], method: :put, data: { confirm: 'The candidate will be automatically rejected. Are you sure?' }

.widgets
  .widget
    .inner
      %h3
        Basic Information
        = edit_button edit_candidate_path(@candidate)

      %p
        %strong Email:
        = email_link @candidate.email
      %p
        %strong ZIP:
        = @candidate.zip
      - if @candidate.location_area
        %p
          %strong Project:
          = @candidate.location_area.area.project.name
      %p
        %strong Entered:
        = friendly_datetime(@candidate.created_at)
      - if @candidate.interview_schedules.any?
        %p
          %strong Interview Time:
          = friendly_datetime(@candidate.interview_schedules.last.start_time)
      %p
        = link_to 'Call', new_call_candidate_candidate_contacts_path(@candidate), class: [:button]
  .widget
    .inner
      %h3 Progress
      %p
        %strong Prescreening:
        - if @candidate.prescreen_answers.empty?
          %span.sm_red INCOMPLETE
        - else
          %span.sm_green COMPLETE
      %p
        %strong Location Selection:
        - unless @candidate.location_area
          %span.sm_red INCOMPLETE
        - else
          %span.sm_green COMPLETE
      %p
        %strong Interview Scheduling:
        - if @candidate.interview_schedules.empty?
          %span.sm_red INCOMPLETE
        - else
          %span.sm_green COMPLETE

      %p
        %strong Interview:
        - if @candidate.interview_answers.empty?
          %span.sm_red INCOMPLETE
        - else
          %span.sm_green COMPLETE
      - offers = @candidate.job_offer_details
      %p
        %strong Sending Paperwork:
        - if offers.empty?
          %span.sm_red INCOMPLETE
        - else
          %span.sm_green COMPLETE
      - status_int = Candidate.statuses[@candidate.status]
      %p
        %strong Paperwork Completed by Candidate:
        - if status_int < 8
          %span.sm_red INCOMPLETE
        - else
          %span.sm_green COMPLETE
      %p
        %strong Paperwork Completed by Advocate:
        - if status_int < 9
          %span.sm_red INCOMPLETE
        - else
          %span.sm_green COMPLETE
      %p
        %strong Paperwork Completed by HR:
        - if status_int < 10
          %span.sm_red INCOMPLETE
        - else
          %span.sm_green COMPLETE
      %p
        %strong Onboarded:
        - if @candidate.person
          %span.sm_green COMPLETE
        - else
          %span.sm_red INCOMPLETE
      - action = ''.html_safe
      - action = case @candidate.status
        - when 'entered'
          - link_to 'Prescreen', new_candidate_prescreen_answer_path(@candidate), class: :button
        - when 'prescreened'
          - link_to 'Select Location', select_location_candidate_path(@candidate, 'false'), class: :button
        - when 'location_selected'
          - link_to 'Schedule Interview', new_candidate_interview_schedule_path(@candidate), class: :button
        - when 'interview_scheduled'
          - link_to 'Interview', new_candidate_interview_answer_path(@candidate), class: :button
        - else
          - ''
      = action
  - if @candidate.location_area
    .widget
      .inner
        %h3 Location Selected
        - location = @candidate.location_area.location
        - location_area = @candidate.location_area
        %p
          %strong Area:
          = area_link location_area.area
        = location.address
        - target = 0
        - potentials = 0
        - current = 0
        - target = location_area.target_head_count if location_area
        - potentials = location_area.potential_candidate_count if location_area
        - current = location_area.current_head_count if location_area
        - open = target - (current + potentials)
        - info_window = "#{location.channel.name}, #{location.display_name}".html_safe
        - info_window += " (##{location.store_number})<br><br>".html_safe
        - info_window += "#{location.address}<br><br>".html_safe
        - info_window += "<strong>Open: #{open}</strong>".html_safe
        #location_map
        %p
          = link_to 'Change Location', select_location_candidate_path(@candidate, 'false'), class: [:button]
.widget
  .inner
    %h3 Communication Log
    = render 'shared/candidate_contacts_table'
.widget
  .inner
    %h3 Log Entries
    = render partial: 'shared/log_entries', locals: { log_entries: @log_entries }

- if @candidate.location_area
  :javascript
    var markers = [];
    markers.push({
      "lat": #{html_escape(location.latitude)},
      "lng": #{html_escape(location.longitude)},
      "picture": {
        "url": "/images/store_map_marker.png",
        "width": 32,
        "height": 32
      },
      "infowindow": '#{info_window}'
    });
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {
      styles: mapStyle()
    }, internal: {id: 'location_map'}}, function () {
      handledMarkers = handler.addMarkers(markers);
      handler.map.centerOn(markers[0]);
      handler.getMap().setZoom(10);
    });
