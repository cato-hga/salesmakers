- title @candidate.name
- content_for :action_buttons do
  - if @candidate.active?
    = link_to 'Dismiss Candidate', dismiss_candidate_path(@candidate), data: { confirm: 'This will dismiss the candidate. Are you sure?' }, class: [:button, :inline_button]
    - if @candidate.status == 'interview_scheduled'
      = link_to 'Reschedule Interview', new_candidate_interview_schedule_path(@candidate), class: [:button, :inline_button], data: { confirm: 'Scheduling another interview for this candidate will remove all previous interviews. Are you sure?' }
    - if @candidate.location_area and @candidate.personality_assessment_status == 'incomplete'
      - unless @candidate.location_area.outsourced?
        = link_to 'Resend Assessment', resend_assessment_candidate_path(@candidate), class: [:button, :inline_button]
    - if @candidate.welcome_call?
      = link_to 'Welcome Call', welcome_call_candidate_path(@candidate), class: [:button, :inline_button]
  - else
    = button_to 'Reactivate Candidate', reactivate_candidate_path(@candidate), data: { confirm: 'This will re-activate the candidate. Are you sure?' }, method: :patch, class: [:button, :inline_button]


.widgets
  .widget#basic_information
    .inner
      %h3
        Basic Information
        = edit_button edit_candidate_path(@candidate)

      %p
        %strong Email:
        = email_link @candidate.email
      %p
        %strong ZIP:
        = @candidate.zip
      - if @candidate.location_area
        %p
          %strong Project:
          = @candidate.location_area.area.project.name
      %p
        %strong Entered:
        = friendly_datetime(@candidate.created_at)
      - if @candidate.interview_schedules.any?
        - if (@candidate.interview_schedules.last.start_time < DateTime.now) and (@candidate.status == 'interview_scheduled')
          %p
            .overdue_interview
              %strong Interview Time:
              = friendly_datetime(@candidate.interview_schedules.last.start_time)
              %strong OVERDUE
        - else
          %p
            %strong Interview Time:
            = friendly_datetime(@candidate.interview_schedules.last.start_time)

      - if @candidate.personality_assessment_status
        %p
          %strong Personality Assessment:
          %span{class: (@candidate.personality_assessment_status == 'qualified' ? 'sm_green' : 'sm_red') }
            = NameCase(@candidate.personality_assessment_status)
      - if @candidate.personality_assessment_score
        %p
          %strong Personality Assessment Score:
          %span{class: (@candidate.personality_assessment_score >= 31 ? 'sm_green' : 'sm_red') }
            = @candidate.personality_assessment_score
      - location_area = @candidate.location_area if @candidate.location_area
      - if CandidatePolicy.new(@current_person, Candidate.new).record_assessment?
        - unless @candidate.passed_personality_assessment? and @candidate.personality_assessment_score.present?
          - if location_area and (location_area.area.personality_assessment_url or location_area.outsourced?)
            = form_tag record_assessment_score_candidate_path(@candidate), method: :put do
              .row.full-width
                .medium-5.columns= number_field_tag :assessment_score
                .medium-7.columns= submit_tag 'Record Assessment Score', class: [:button, :inline_button, 'full-width']
      %p
        = link_to 'Call', new_call_candidate_candidate_contacts_path(@candidate), class: [:button]
  .widget
    .inner
      %h3 Progress
      %p
        %strong Prescreening:
        - if @candidate.prescreen_answers.empty?
          %span.sm_red INCOMPLETE
        - else
          %span.sm_green COMPLETE
      %p
        %strong Location Selection:
        - unless @candidate.location_area
          %span.sm_red INCOMPLETE
        - else
          %span.sm_green COMPLETE
      %p
        %strong Interview Scheduling:
        - if @candidate.interview_schedules.empty?
          %span.sm_red INCOMPLETE
        - else
          %span.sm_green COMPLETE

      %p
        %strong Interview:
        - if @candidate.interview_answers.empty?
          %span.sm_red INCOMPLETE
        - else
          %span.sm_green COMPLETE
      - offers = @candidate.job_offer_details
      %p
        %strong Confirmation of Details:
        - if @candidate.training_availability
          %span.sm_green COMPLETE
        - else
          %span.sm_red INCOMPLETE
      - offers = @candidate.job_offer_details
      %p
        %strong Sending Paperwork:
        - if offers.empty?
          %span.sm_red INCOMPLETE
        - else
          %span.sm_green COMPLETE
      - status_int = Candidate.statuses[@candidate.status]
      %p
        %strong Paperwork Completed by Candidate:
        - if status_int < 9 and not @candidate.person
          %span.sm_red INCOMPLETE
        - else
          %span.sm_green COMPLETE
      %p
        %strong Paperwork Completed by Advocate:
        - if status_int < 10 and not @candidate.person
          %span.sm_red INCOMPLETE
        - else
          %span.sm_green COMPLETE
      %p
        %strong Paperwork Completed by HR:
        - if status_int < 11 and not @candidate.person
          %span.sm_red INCOMPLETE
        - else
          %span.sm_green COMPLETE
      %p
        %strong Onboarded:
        - if @candidate.person
          %span.sm_green COMPLETE
        - else
          %span.sm_red INCOMPLETE
      - action = ''.html_safe
      - action = case @candidate.status
        - when 'entered'
          - link_to 'Prescreen', new_candidate_prescreen_answer_path(@candidate), class: :button
        - when 'prescreened'
          - link_to 'Select Location', select_location_candidate_path(@candidate, 'false'), class: :button
        - when 'location_selected'
          - link_to 'Schedule Interview', new_candidate_interview_schedule_path(@candidate), class: :button
        - when 'interview_scheduled'
          - link_to 'Interview', new_candidate_interview_answer_path(@candidate), class: :button
        - when 'accepted'
          - if @candidate.job_offer_details == []
            - link_to 'Confirm Details and Send Paperwork', confirm_candidate_path(@candidate), class: :button
          - else
            - ''
        - when 'confirmed'
          - if @candidate.passed_personality_assessment?
            - link_to 'Send or Resend Paperwork', send_paperwork_candidate_path(@candidate), class: :button
          - else
            - ''
        - when 'paperwork_sent'
          - if @candidate.training_availability == nil
            - link_to 'Confirm Details', confirm_candidate_path(@candidate), class: :button
          - elsif @candidate.job_offer_details.present? or @candidate.job_offer_details.first.envelope_guid
            - if CandidatePolicy.new(@current_person, Candidate.new).record_assessment?
              - link_to 'Resend Paperwork', send_paperwork_candidate_path(@candidate), class: :button
          - else
            - ''
        - else
          - if @candidate.training_availability == nil
            - link_to 'Confirm Details', confirm_candidate_path(@candidate), class: :button
          - else
            - ''
      = action if @candidate.active?
  - if @candidate.location_area
    = render 'location_information'
  = render 'availability'
  - if @candidate.training_availability.present? or @candidate.shirt_gender.present? or @candidate.shirt_size.present?
    = render 'candidate_details'

  - unless @candidate.interview_answers.empty?
    = render 'interview_answers'


.widget
  .inner
    %h3 Communication Log
    = render 'shared/candidate_contacts_table'
.widget
  .inner
    %h3 Log Entries
    = render partial: 'shared/log_entries', locals: { log_entries: @log_entries }