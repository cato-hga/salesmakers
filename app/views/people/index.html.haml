- content_for :action_buttons do
  = link_to icon('indent-more') + ' Org Chart', org_chart_people_path, class: [:button, :inline_button]

- content_for :header do
  = search_form_for @search, class: 'search_form', html: { method: :post }, url: search_people_path do |f|
    = link_to 'Clear', request.path if params[:q]
    = f.select :active_eq, [['Active', true],['Inactive', false]], include_blank: 'All'
    = f.text_field :eid_eq, placeholder: 'EID'
    = f.text_field :display_name_cont, placeholder: 'Name'
    = f.text_field :email_cont, placeholder: 'Email'
    = f.text_field :mobile_phone_number_cont, placeholder: 'Phone'

    = f.text_field :position_name_cont, placeholder: 'Position'
    = f.text_field :supervisor_display_name_cont, placeholder: 'Supervisor'
    = f.text_field :areas_name_cont, placeholder: 'Area(s)'
    = f.submit 'Search', class: [:button, :inline_button]
  .top-pagination
    = paginate @people

%section
  - header = header_row ['EID','Hired', 'Term\'d', 'Name','Email','Phone','Position','Supervisor','Area(s)']
  - rows = Array.new
  - for person in @people do
    - show_details = @visible_people.include?(person) ? true : false
    - blocked = content_tag(:div, '-', class: :blocked)
    - classes = person.active? ? '' : 'inactive'
    - if person.employments.count > 0
      - hired = show_details ? link_to(person.employments.first.start.strftime('%-m/%-d/%Y'), person, class: classes) : blocked
    - else
      - hired = ''
    - if person.employments.count > 0 and person.employments.first.end and person.employments.first.end.strftime('%Y').to_i < 2008
      - termed = show_details ? link_to('Unknown', person, class: classes) : blocked
    - elsif person.employments.count > 0 and person.employments.first.end
      - termed = show_details ? link_to(person.employments.first.end.strftime('%-m/%-d/%Y'), person, class: classes) : blocked
    - else
      - termed = ''
    - if person.eid
      - eid = show_details ? link_to(person.eid, person, class: classes) : blocked
    - else
      - eid = ''
    - display_name = person_link person, classes
    - email = mail_to person.email, person.email, class: classes
    - if person.office_phone
      - phone = content_tag(:em, 'o:') + phone_link(person.office_phone, classes)
    - elsif person.mobile_phone
      - phone = content_tag(:em, 'm:') + phone_link(person.mobile_phone, classes)
      - phone = show_details ? phone : blocked
    - elsif person.home_phone
      - phone = content_tag(:em, 'h:') + phone_link(person.home_phone, classes)
      - phone = show_details ? phone : blocked
    - else
      - phone = ''
    - if phone.include? '(800) 555-1212'
      - phone = ''
    - position = person.position
    - position_link = position ? link_to(position.name, person, class: classes) : ''
    - supervisor = person.supervisor ? person_link(person.supervisor, classes) : ''
    - area = person_area_links person, classes
    - rows << table_row([eid, hired, termed, display_name, email, phone, position_link, supervisor, area])
  = table header, rows

- content_for :footer do
  = paginate @people